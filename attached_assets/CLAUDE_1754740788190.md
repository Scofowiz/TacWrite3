# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

```bash
# Development server
npm run dev

# Build production
npm run build

# Start production server
npm start

# Linting
npm run lint

# Type checking
npm run typecheck
```

## Architecture Overview

TACWrite is a Next.js application for AI-powered writing assistance with reinforcement learning capabilities.

### Core Structure
- **Next.js 15** with TypeScript and Tailwind CSS
- **Component architecture** using Radix UI and custom components
- **AI integration** with multiple agent types for different writing tasks
- **Project management** with localStorage persistence via mock backend
- **Reinforcement Learning** framework for AI model improvement

### Key Directories

#### `/src/ai/`
- **`flows/`** - Core AI workflows (autonomous-continuation, character-profile, etc.)
- **`agents/`** - Enhanced AI agents with specialized capabilities:
  - `enhanced_autonomous_agent.ts` - Advanced continuation with WFA trends
  - `enhanced_chapter_agent.ts` - Chapter ending specialization  
  - `enhanced_tutor_agent.ts` - Writing education and feedback
  - `community_memory_pool.ts` - Shared learning across users
  - `agent_container_system.ts` - Agent orchestration and fault tolerance

#### `/src/lib/`
- **`project-context.tsx`** - React context for project/document state management
- **`mock-projects.ts`** - LocalStorage-backed project database
- **`rl-client.ts`** - Reinforcement learning action wrapper with tracking
- **`rl-memory.ts`** - Contextual memory management for AI agents
- **`ai-client.ts`** - AI service integration layer

#### `/src/components/`
- **Component hierarchy**: `tacwrite-rl-page.tsx` is the main application component
- **UI components** in `/ui/` follow Radix UI patterns with custom styling
- **Feature modules**: auth, collaboration, import-export, manuscript, projects, publishing

## Project System

The application uses a mock project database (`mockProjectDb`) that persists to localStorage:
- **Projects** contain chapters and standalone documents
- **Chapters** group related documents  
- **Documents** are individual writing pieces with content, word count, and metadata
- All CRUD operations automatically save to localStorage via `saveProjects()`

## AI Agent System

### Flow Types
- `autonomous-continuation` - Continue writing to target word count
- `character-profile-flow` - Generate character analysis
- `socratic-tutor-flow` - Educational writing guidance
- `plot-analysis-flow` - Story structure analysis

### Enhanced Agents
Enhanced agents extend base flows with additional capabilities:
- Market trend integration (WFA agent)
- Community memory sharing
- Multi-model orchestration
- Publishing specialization

### Reinforcement Learning
- Actions wrapped with `createRLActionWrapper()` for feedback tracking
- Memory persistence via `ContextualMemoryManager`
- User feedback collection for model improvement
- Generation tracking with UUIDs for feedback correlation

## Configuration Notes

- **TypeScript**: Strict mode enabled, build errors ignored in next.config.js
- **Images**: Remote patterns configured for placehold.co
- **Development**: Webpack caching disabled to prevent corruption
- **Path aliases**: `@/*` maps to `./src/*`

## Integration Status

**AGENT MIGRATION IN PROGRESS:**

**CONFIRMED MAPPING (Ready for Implementation):**
```
OLD FLOWS → NEW AGENTS:
generate-text-block.ts      → enhanced_author_agent.ts
continue-text.ts            → enhanced_continue_agent.ts  
autonomous-continuation.ts  → enhanced_autonomous_agent.ts
end-chapter.ts             → enhanced_chapter_agent.ts
writing-tutor-flow.ts      → enhanced_tutor_agent.ts
contextual-enrichment.ts   → enhanced_enhance_agent_complete.ts
```

**NEW AGENTS TO INTEGRATE:**
- community_memory_pool.ts (shared intelligence foundation)
- agent_container_system.ts (orchestration infrastructure)  
- doctor_agent_flow.ts, marie_kondo_agent_flow.ts
- wfa_agent_flow.ts, large_context_agent_flow.ts
- polish_agent_flow.ts, agent_orchestrator.ts

**NEXT SESSION:** Start with foundation (memory pool + container system), then replace the 6 flows with enhanced agents, integrate new agents, update imports/exports, create API routes.